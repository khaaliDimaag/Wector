function checkHighlight(){var e="";window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),""!=e&&e.length<50&&e!=lastQuery&&initializeHome(1,function(){hasSet&&main(e)})}function displaySettingsAlert(){var e=document.createElement("div"),t=chrome.extension.getURL("/logo48w.png");e.innerHTML="<img src = '"+t+"' style='width:40px; vertical-align:middle;' /> needs to know where you are to show you travel estimates. Click here to set it up!",e.id="setAlert",e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.width="100%",e.style.color="white",e.style.font="menu",e.style.fontSize="16px",e.style.border="0",e.style.borderRadius="0px",e.style.zIndex="2147483648",e.style.textAlign="center",e.style.display="none",e.style.padding="0.5%",$(e).on("click",function(){chrome.runtime.sendMessage({message:"showOptions"})}),document.body.appendChild(e),$(e).slideDown("fast"),setTimeout(function(){$(e).slideUp("fast",function(){document.contains(e)&&document.body.removeChild(e)})},6660)}function main(e){console.log("  "+latsrc+","+lonsrc+"    "+home+"\n"+maxWalkSpd+"  "+(60*maxWalkTimeH+maxWalkTimeM)/60+" "+maxWalkDist+" "+maxWalkTimeH+":"+maxWalkTimeM+"\n"+maxBikeSpd+"  "+(60*maxBikeTimeH+maxBikeTimeM)/60+" "+maxBikeDist+" "+maxBikeTimeH+":"+maxBikeTimeM+"\n");var t=e;lastQuery=t;var a=t;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/distancematrix/json?origins="+home+"&destinations="+a+"&language=en-EN",success:function(e){var t=e.rows[0],a=t.elements[0],i=a.status,n=e.destination_addresses[0],s=e.origin_addresses[0];if("ZERO_RESULTS"==i){var o=-1,l=-1;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+n,success:function(e){o=e.results[0].geometry.location.lat,l=e.results[0].geometry.location.lng,console.log(o+" "+l+"\n"+latsrc+" "+lonsrc);var t=getFlight(o,l,latsrc,lonsrc),a="<i class='fa fa-paper-plane-o'></i>  "+t+" hour";1!=t&&(a+="s"),alertUser(s,n,"",a,"","",0,1,0,0)}})}else if("OK"==i){var m=a.distance,d=a.duration,c=" <i class='fa fa-car'></i>  "+d.text,r=" <i class='fa fa-paper-plane-o'></i>  ",u=" <i class='zmdi zmdi-directions-walk'></i>  ",y=" <i class='fa fa-bicycle'></i>  ";if(.95*m.value<=Math.max(maxWalkDist,maxBikeDist)){var g,h=.95*m.value/maxWalkSpd,p=Math.floor(h);g=0==p?" ":1==p?" "+p+" hour":" "+p+" hours";var f=Math.floor(60*(h-p)),k=" "+f+" min";1!=f&&(k+="s"),u+=g+k;var x,v=.95*m.value/maxBikeSpd,B=Math.floor(v);x=0==B?" ":1==B?" "+B+" hour":" "+B+" hours";var T=Math.floor(60*(v-B)),E=" "+T+" min";1!=T&&(E+="s"),y+=x+E;var b=!0;(B>maxBikeTimeH||B==maxBikeTimeH&&T>maxBikeTimeM)&&(b=!1);var w=!0;(p>maxWalkTimeH||p==maxWalkTimeH&&f>maxWalkTimeM)&&(w=!1);var M=1,W=0,H=0;return b?(W=1,M=2,w&&(H=1,W=2,M=3)):w&&(H=1,M=2,b&&(H=1,W=2,M=3)),void alertUser(s,n,c,r,y,u,M,0,W,H)}if(d.value<7200)alertUser(s,n,c,r,y,u,1,0,0,0);else{var o=-1,l=-1;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+n,success:function(e){o=e.results[0].geometry.location.lat,l=e.results[0].geometry.location.lng,console.log(o+" "+l+"\n"+latsrc+" "+lonsrc);var t=getFlight(o,l,latsrc,lonsrc);r+=t+" hour",1!=t&&(r+="s"),d.value<36e3?alertUser(s,n,c,r,y,u,1,2,0,0):alertUser(s,n,c,r,y,u,2,1,0,0)}})}}}})}function findWidth(e,t,a,i){var n=e+t+a+i;return 10==n?"four":6==n?"three":3==n?"two":"one"}function resetBodyClass(){document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bone\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\btwo\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bthree\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bfour\b/,"")}function alertUser(e,t,a,i,n,s,o,l,m,d){var c="https://www.google.com/maps/dir/"+e+"/"+t;t="<div id = 'address'>"+t+"</div>";var r=" "+findWidth(d,m,l,o),u=t,y="<a href='"+c+"' target='_blank' ><i class='fa fa-external-link'></i></a>";y="<div id = 'links'>"+y+"</div>",u+="<div id = 'info'>",a="<div class = 'mode'>"+a+"</div>",i="<div class = 'mode'>"+i+"</div>",n="<div class = 'mode'>"+n+"</div>",s="<div class = 'mode'>"+s+"</div>",u+=1==o?a:1==l?i:1==m?n:1==d?s:"",u+=2==o?a:2==l?i:2==m?n:2==d?s:"",u+=3==o?a:3==l?i:3==m?n:3==d?s:"",u+=4==o?a:4==l?i:4==m?n:4==d?s:"",u+="</div>",u+=y;var g=document.createElement("div");g.innerHTML=u,g.id="Wector",g.style.position="fixed",g.style.bottom="0",g.style.left="0",g.style.width="100%",g.style.background="rgba(0,0,0,0.9)",g.style.color="white",g.style.font="menu",g.style.fontSize="16px",g.style.border="0",g.style.borderRadius="0px",g.style.zIndex="2147483648",g.style.textAlign="center",g.style.display="none",g.onclick=function(){lastQuery="",$(g).slideUp("fast",function(){document.body.removeChild(g)})};var h=document.getElementById("Wector");null==h?(resetBodyClass(),document.getElementsByTagName("body")[0].className+=r,document.body.appendChild(g),$(g).slideDown("fast",function(){var e=$("#address").height();document.getElementById("info").style.lineHeight=e+"px",document.getElementById("links").style.lineHeight=e+"px";var t=$("#address").width()+$("#info").width()+$("#links").width(),a=$(this).width();Math.abs(1.03*t-a)>5&&(document.getElementById("address").style.width="36%",document.getElementById("info").style.width="60%",document.getElementById("links").style.width="4%")}),setTimeout(function(){$(g).slideUp("fast",function(){document.contains(g)&&document.body.removeChild(g)})},6660)):$(h).slideUp("fast",function(){document.body.removeChild(h),resetBodyClass(),document.getElementsByTagName("body")[0].className+=r,document.body.appendChild(g),$(g).slideDown("fast",function(){var e=$("#address").height();document.getElementById("info").style.lineHeight=e+"px",document.getElementById("links").style.lineHeight=e+"px";var t=$("#address").width()+$("#info").width()+$("#links").width(),a=$(this).width();Math.abs(1.03*t-a)>5&&(document.getElementById("address").style.width="36%",document.getElementById("info").style.width="60%",document.getElementById("links").style.width="4%")}),setTimeout(function(){$(g).slideUp("fast",function(){document.contains(g)&&document.body.removeChild(g)})},6660)})}function initializeHome(e,t){chrome.storage.sync.get({latitude:42.4534492,longitude:-76.4735027,address:"Cornell University",mWS:5e3,mBS:14e3,mWTH:0,mBTH:0,mWTM:30,mBTM:30,exists:!1},function(a){latsrc=a.latitude,lonsrc=a.longitude,home=a.address,maxWalkSpd=a.mWS,maxBikeSpd=a.mBS,maxWalkTimeH=a.mWTH,maxBikeTimeH=a.mBTH,maxWalkTimeM=a.mWTM,maxBikeTimeM=a.mBTM,maxWalkDist=maxWalkSpd*(maxWalkTimeH+maxWalkTimeM/60),maxBikeDist=maxBikeSpd*(maxBikeTimeH+maxBikeTimeM/60),hasSet=a.exists,hasSet||1!=e||displaySettingsAlert(),t()})}function atWectorML(){try{null!=document.getElementById("thisIsForTheExtension")&&(document.getElementById("install").style.display="none",document.getElementById("try").style.display="none",document.getElementById("alreadyhave").style.display="block",document.getElementById("p1a").onclick=function(){chrome.runtime.sendMessage({message:"showOptions"})},document.getElementById("p2a").onclick=function(){document.getElementById("p2a").innerHTML="khaaliDimaag.io@gmail.com",document.getElementById("p2a").style.cursor="auto"})}catch(e){console.log(e)}}function getFlight(e,t,a,i){var n=haversine(e,t,a,i),s=Math.min(n,300),o=n-s,l=s/400,m=o/800,d=l+m;return Math.ceil(100*d/100)}function haversine(){var e=Array.prototype.map.call(arguments,function(e){return e/180*Math.PI}),t=e[0],a=e[1],i=e[2],n=e[3],s=6372.8,o=i-t,l=n-a,m=Math.sin(o/2)*Math.sin(o/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(t)*Math.cos(i),d=2*Math.asin(Math.sqrt(m));return s*d}var fa_link=document.createElement("link");fa_link.rel="stylesheet",fa_link.href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",document.getElementsByTagName("head")[0].appendChild(fa_link);var md_link=document.createElement("link");md_link.rel="stylesheet",md_link.href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.0.2/css/material-design-iconic-font.min.css",document.getElementsByTagName("head")[0].appendChild(md_link);var latsrc,lonsrc,home,hasSet,maxWalkSpd,maxBikeSpd,maxWalkTimeH,maxBikeTimeH,maxWalkTimeM,maxBikeTimeM,maxWalkDist,maxBikeDist,lastQuery="";atWectorML(),initializeHome(0,function(){}),document.onmouseup=checkHighlight;