/* Thanks to : http://javascript-minifier.com/ */
function setHide(){hide=!1}function checkHighlight(){if(!hide){var e="";window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),""!=e&&e.length<50&&e!=lastQuery&&initializeHome(1,function(){hasSet&&main(e)})}}function displaySettingsAlert(){var e=document.createElement("div"),t=chrome.extension.getURL("/logo48w.png");e.innerHTML="<img src = '"+t+"' style='width:40px; vertical-align:middle;' /> needs to know where you are to show you travel estimates. Click here to set it up!",e.id="WectorSetAlert",e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.width="100%",e.style.color="white",e.style.font="menu",e.style.fontSize="16px",e.style.border="0",e.style.borderRadius="0px",e.style.zIndex="2147483648",e.style.textAlign="center",e.style.display="none",e.style.padding="0.5%",$(e).on("click",function(){chrome.runtime.sendMessage({message:"showOptions"})}),document.body.appendChild(e),$(e).slideDown("fast"),setTimeout(function(){$(e).slideUp("fast",function(){document.contains(e)&&document.body.removeChild(e)})},6660)}function main(e){var t=e;lastQuery=t;var n=t;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/distancematrix/json?origins="+home+"&destinations="+n+"&language=en-EN",success:function(e){var t=e.rows[0],n=t.elements[0],o=n.status,i=e.destination_addresses[0],s=e.origin_addresses[0];if("ZERO_RESULTS"==o){var a=-1,l=-1;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+i,success:function(e){a=e.results[0].geometry.location.lat,l=e.results[0].geometry.location.lng;var t=getFlight(a,l,latsrc,lonsrc),n="<i class='fa fa-paper-plane-o Wector-plane'></i>  "+t+" hour";1!=t&&(n+="s"),alertUser(s,i,"",n,"","",0,1,0,0)}})}else if("OK"==o){var d=n.distance,c=n.duration,m=" <i class='fa fa-car Wector-car'></i>  "+c.text,r=" <i class='fa fa-paper-plane-o Wector-plane'></i>  ",u=" <i class='zmdi zmdi-directions-walk Wector-walk'></i>  ",y=" <i class='fa fa-bicycle Wector-cycle'></i>  ";if(.95*d.value<=Math.max(maxWalkDist,maxBikeDist)){var h,g=.95*d.value/maxWalkSpd,f=Math.floor(g);h=0==f?" ":1==f?" "+f+" hour":" "+f+" hours";var p=Math.floor(60*(g-f)),W=" "+p+" min";1!=p&&(W+="s"),u+=h+W;var k,v=.95*d.value/maxBikeSpd,x=Math.floor(v);k=0==x?" ":1==x?" "+x+" hour":" "+x+" hours";var B=Math.floor(60*(v-x)),T=" "+B+" min";1!=B&&(T+="s"),y+=k+T;var w=!0;(x>maxBikeTimeH||x==maxBikeTimeH&&B>maxBikeTimeM)&&(w=!1);var E=!0;(f>maxWalkTimeH||f==maxWalkTimeH&&p>maxWalkTimeM)&&(E=!1);var b=1,M=0,I=0;return w?(M=1,b=2,E&&(I=1,M=2,b=3)):E&&(I=1,b=2,w&&(I=1,M=2,b=3)),void alertUser(s,i,m,r,y,u,b,0,M,I)}if(c.value<7200)alertUser(s,i,m,r,y,u,1,0,0,0);else{var a=-1,l=-1;$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+i,success:function(e){a=e.results[0].geometry.location.lat,l=e.results[0].geometry.location.lng;var t=getFlight(a,l,latsrc,lonsrc);r+=t+" hour",1!=t&&(r+="s"),c.value<36e3?alertUser(s,i,m,r,y,u,1,2,0,0):alertUser(s,i,m,r,y,u,2,1,0,0)}})}}}})}function findWidth(e,t,n,o){var i=e+t+n+o;return 10==i?"Wector4":6==i?"Wector3":3==i?"Wector2":"Wector1"}function resetBodyClass(){document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bWector1\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bWector2\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bWector3\b/,""),document.getElementsByTagName("body")[0].className=document.getElementsByTagName("body")[0].className.replace(/\bWector4\b/,"")}function alertUser(e,t,n,o,i,s,a,l,d,c){var m="https://www.google.com/maps/dir/"+e+"/"+t;t="<div id = 'WectorAddress'>"+t+"</div>";var r=" "+findWidth(c,d,l,a),u=t,y="<i class='zmdi zmdi-directions Wector-map'></i>  Route";y="<div id = 'WectorLinks'>"+y+"</div>",u+="<div id = 'WectorInfo'>",n="<div class = 'WectorMode'>"+n+"</div>",o="<div class = 'WectorMode'>"+o+"</div>",i="<div class = 'WectorMode'>"+i+"</div>",s="<div class = 'WectorMode'>"+s+"</div>",u+=1==a?n:1==l?o:1==d?i:1==c?s:"",u+=2==a?n:2==l?o:2==d?i:2==c?s:"",u+=3==a?n:3==l?o:3==d?i:3==c?s:"",u+=4==a?n:4==l?o:4==d?i:4==c?s:"",u+="</div>",u+=y;var h=document.createElement("div");h.innerHTML=u,h.id="Wector",h.style.position="fixed",h.style.bottom="0",h.style.left="0",h.style.width="100%",h.style.background="rgba(0,0,0,0.9)",h.style.color="white",h.style.font="menu",h.style.fontSize="16px",h.style.border="0",h.style.borderRadius="0px",h.style.zIndex="2147483648",h.style.textAlign="center",h.style.display="none",h.onclick=function(){lastQuery="",$(h).slideUp("fast",function(){document.body.removeChild(h)})};var g=document.getElementById("Wector");null==g?(resetBodyClass(),document.getElementsByTagName("body")[0].className+=r,document.body.appendChild(h),$(h).slideDown("fast",function(){var e=$("#WectorAddress").height();document.getElementById("WectorInfo").style.lineHeight=e+"px",document.getElementById("WectorLinks").style.lineHeight=e+"px";var t=$("#WectorAddress").width()+$("#WectorInfo").width()+$("#WectorLinks").width(),n=$(this).width();Math.abs(1.03*t-n)>5&&(document.getElementById("WectorAddress").style.width="36%",document.getElementById("WectorInfo").style.width="48%",document.getElementById("WectorLinks").style.width="16%")}),document.getElementById("WectorAddress").onclick=function(){hide=!0},document.getElementById("WectorInfo").onclick=function(){hide=!0},document.getElementById("WectorLinks").onclick=function(){window.open(m,"_blank")},setTimeout(function(){$(h).slideUp("fast",function(){document.contains(h)&&document.body.removeChild(h)})},6660)):$(g).slideUp("fast",function(){document.body.removeChild(g),resetBodyClass(),document.getElementsByTagName("body")[0].className+=r,document.body.appendChild(h),$(h).slideDown("fast",function(){var e=$("#WectorAddress").height();document.getElementById("WectorInfo").style.lineHeight=e+"px",document.getElementById("WectorLinks").style.lineHeight=e+"px";var t=$("#WectorAddress").width()+$("#WectorInfo").width()+$("#WectorLinks").width(),n=$(this).width();Math.abs(1.03*t-n)>5&&(document.getElementById("WectorAddress").style.width="36%",document.getElementById("WectorInfo").style.width="48%",document.getElementById("WectorLinks").style.width="16%")}),document.getElementById("WectorAddress").onclick=function(){hide=!0},document.getElementById("WectorInfo").onclick=function(){hide=!0},document.getElementById("WectorLinks").onclick=function(){window.open(m,"_blank")},setTimeout(function(){$(h).slideUp("fast",function(){document.contains(h)&&document.body.removeChild(h)})},6660)})}function initializeHome(e,t){chrome.storage.sync.get({latitude:42.4534492,longitude:-76.4735027,address:"Cornell University",mWS:5e3,mBS:14e3,mWTH:0,mBTH:0,mWTM:30,mBTM:30,exists:!1},function(n){latsrc=n.latitude,lonsrc=n.longitude,home=n.address,maxWalkSpd=n.mWS,maxBikeSpd=n.mBS,maxWalkTimeH=n.mWTH,maxBikeTimeH=n.mBTH,maxWalkTimeM=n.mWTM,maxBikeTimeM=n.mBTM,maxWalkDist=maxWalkSpd*(maxWalkTimeH+maxWalkTimeM/60),maxBikeDist=maxBikeSpd*(maxBikeTimeH+maxBikeTimeM/60),hasSet=n.exists,hasSet||1!=e||displaySettingsAlert(),t()})}function atWectorML(){try{null!=document.getElementById("thisIsForTheExtension")?(document.getElementById("install").style.display="none",document.getElementById("try").style.display="none",document.getElementById("alreadyhave").style.display="block",document.getElementById("p1a").onclick=function(){chrome.runtime.sendMessage({message:"showOptions"})}):console.log("Thanks for using Wector! Visit us at http://wector.ml")}catch(e){console.log("Wector Error: "+e)}}function getFlight(e,t,n,o){var i=haversine(e,t,n,o),s=Math.min(i,300),a=i-s,l=s/400,d=a/800,c=l+d;return Math.ceil(100*c/100)}function haversine(){var e=Array.prototype.map.call(arguments,function(e){return e/180*Math.PI}),t=e[0],n=e[1],o=e[2],i=e[3],s=6372.8,a=o-t,l=i-n,d=Math.sin(a/2)*Math.sin(a/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(t)*Math.cos(o),c=2*Math.asin(Math.sqrt(d));return s*c}var fa_link=document.createElement("link");fa_link.rel="stylesheet",fa_link.href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",document.getElementsByTagName("head")[0].appendChild(fa_link);var md_link=document.createElement("link");md_link.rel="stylesheet",md_link.href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.0.2/css/material-design-iconic-font.min.css",document.getElementsByTagName("head")[0].appendChild(md_link);var latsrc,lonsrc,home,hasSet,maxWalkSpd,maxBikeSpd,maxWalkTimeH,maxBikeTimeH,maxWalkTimeM,maxBikeTimeM,maxWalkDist,maxBikeDist,lastQuery="";atWectorML(),initializeHome(0,function(){});var hide;window.onload=setHide,document.onmouseup=checkHighlight;